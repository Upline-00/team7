{% extends 'base.html' %}
{% load static %}

{% block content %}
<head>
    <title>Chat with ChatGPT</title>
</head>
<body>
    <h1>Chat with ChatGPT</h1>
    <div id="chat-container">
        <div id="chat-history"></div>
        <input type="text" id="user-input">
        <button id="send-btn">Send</button>
    </div>

    <script>
        const chatHistoryElement = document.getElementById("chat-history");
        const userInputElement = document.getElementById("user-input");
        const sendButton = document.getElementById("send-btn");

        sendButton.addEventListener("click", async () => {
            const userMessage = userInputElement.value;
            userInputElement.value = "";

            const chatHistory = chatHistoryElement.innerHTML;
            const response = await fetch("/chatbotapp/chat/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "X-CSRFToken": getCookie("csrftoken")
                },
                body: `user_input=${encodeURIComponent(userMessage)}&chat_history=${encodeURIComponent(chatHistory)}`
            });

            const responseData = await response.json();
            const botResponse = responseData.bot_response;

            chatHistoryElement.innerHTML = `${chatHistory}User: ${userMessage}<br>ChatGPT: ${botResponse}<br>`;
        });

        function getCookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
        }
    </script>
{% endblock %}

